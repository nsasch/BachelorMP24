<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>The Bachelor - A Facebook Game</title>
    
    <meta name="description" content="A Facebook game for the popular TV show The Bachelor">
    <meta name="author" content="Nicholas Asch, Alice Bevan-McGregor, and Nicolas Cadou">
    <meta name="viewport" content="width=1024, user-scalable=no">
    
    <!-- Core and extension CSS files -->
    <link rel="stylesheet" href="core/deck.core.css">
    <link rel="stylesheet" href="extensions/goto/deck.goto.css">
    <link rel="stylesheet" href="extensions/menu/deck.menu.css">
    <link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
    <link rel="stylesheet" href="extensions/status/deck.status.css">
    <link rel="stylesheet" href="extensions/hash/deck.hash.css">
    
    <!-- Theme CSS files (menu swaps these out) -->
    <link rel="stylesheet" id="style-theme-link" href="themes/style/neon.css">
    <link rel="stylesheet" id="transition-theme-link" href="themes/transition/fade.css">
    
    <!-- Custom CSS just for this page -->
    <link rel="stylesheet" href="introduction.css">
    <link rel="stylesheet" href="highlight/styles/sunburst.css">
    
    <script src="modernizr.custom.js"></script>
</head>

<body class="deck-container">

<section class="slide" id="title-slide">
    <h1>Developing The&nbsp;Bachelor<h1/>
</section>

<section class="slide" id="overview">
    <h2>What is The Bachelor?</h2>
    <ol>
        <li>
            <h3>The show</h3>
            <p>Reality dating game show</p>
        </li>
        <li>
            <h3>Competition</h3>
            <p>Contestants compete to be selected through elimination rounds.</p>
        </li>
        <li>
            <h3>Limited Participants</h3>
            <p>Only 25 participants in the TV show; a Facebook game lets the audience play too!</p>
        </li>
    </ol>
</section>

<section class="slide" id="team">
    <h2>The Development Team</h2>
    <ul>
        <li>
            <h3>Nicholas Asch</h3>
        </li>
        <li>
            <h3>Alice Bevan-McGregor</h3>
        </li>
        <li>
            <h3>Nicolas Cadou</h3>
        </li>
        <li>
            <h3>Blaise Laflamme</h3>
        </li>
        <li>
            <h3>Egor Miadzvedeu</h3>
        </li>
        <li>
            <h3>Zachary Allatt</h3>
        </li>
</section>

<section class="slide" id="ncadou">
</section>

<section class="slide" id="infrastructure">
    <h2>Infrastructure</h2>
    <p>
        <img src="images/infrastructure.jpg" alt="Infrastructure" />
    </p>
</section>

<section class="slide" id="libraries">
    <h2>Libraries</h2>
    <h3>Main libs</h3>
    <ul>
        <li>Pyramid</li>
        <li>MongoEngine</li>
        <li>zc.buildout</li>
        <li>lettuce</li>
    </ul>
    <h3>Also</h3>
    <ul>
        <li>SCSS</li>
        <li>futures</li>
        <li>apscheduler</li>
        <li>marrow.mailer</li>
    </ul>
</section>

<section class="slide" id="architecture">
    <h2>Architecture</h2>
    <h3>Run of the mill MVC-ish</h3>
    <p>&nbsp;</p>
    <div class="slide controller">
        <h4>Controller</h4>
        <p>Pyramid Routes + Views</p>
    </div>
    <div class="slide model">
        <h4>Model</h4>
        <p>Core API + Data Access Layer</p>
    </div>
    <div class="slide view">
        <h4>View</h4>
        <p>Views + Templates</p>
    </div>
</section>

<section class="slide" id="thin-views">
    <h2>Architecture</h2>
    <h3>Thin views</h3>
    <pre><code class="python">
@view_config(route_name='audition_enter', http_cache=0,
             renderer='bachelor:templates/show/audition/enter.mako')
def audition_enter(self):
    return dict(show=self._show)

@view_config(route_name='audition_enter_confirm', request_method='POST',
        xhr=True, renderer='json', http_cache=0)
def audition_ajax(self):
    if self.request.POST.get('photo'):
        photo = json.loads(self.request.POST.get('photo'))['url']
    else:
        photo = None

    self.show_api.audition(self._show, picture=photo)

    return dict(next=self.request.route_path('audition_list'))
    </code></pre>
</section>

<section class="slide" id="bad-views">
    <h2>Architecture</h2>
    <h3>Fat views (yuk!)</h3>
    <pre><code class="python">
@view_config(route_name='event_list', http_cache=0,
             renderer='bachelor:templates/event/list.mako')
def list_(self):
    """ Return a list of events, customized for the user. """
    page = int(self.request.params.get('page', 1))
    reward = Tuneable.get_event_gain(self.user_api.level(self.user))
    cost = Tuneable.get_topic_cost(self.user_api.level(self.user))
    score = self.user_api.get_score()
    can_participate = cost.validate(score)
    details = cost.validate(score, True)
    notifications = self.user_api.notifications(self.user)

    allowed_cities = Tuneable.get_allowed_cities(self.user_api.level())
    current_city = self.request.session.get('current_city', None)

    if self.request.method == 'POST' and 'city' in self.request.params:
        current_city = self.request.POST.get('city', None)

    if not current_city:
        current_city = allowed_cities[0]
    elif current_city not in allowed_cities:
        current_city = 'hell'  # easter egg for those who like to play with
                               # data

    self.request.session['current_city'] = current_city
    self.request.session['allowed_cities'] = allowed_cities

    paginated_events = Pagination(self.event_api.get_user_events(
        with_events=True, city=current_city),
        Tuneable.get_per_page('events'),
        Tuneable.get_pages_per_chunk())

    return dict(
            user_events=paginated_events.get_page_items(page),
            pagination=paginated_events,
            current_page=page,
            reward=reward,
            requirement=cost,
            can_participate=can_participate,
            req_details=details,
            notifications=notifications,
            cities=Tuneable.get_cities(),
            current_city=current_city,
            allowed_cities=allowed_cities,
        )
    </code></pre>
</section>

<section class="slide" id="api-layer">
    <h2>Architecture</h2>
    <h3>API Layer and Data Access</h3>

    <div class="slide">
        <h4>Instead of littering the API with stuff like this</h4>
        <pre><code class="python">
u = UserIO.one(user_id)

if not u:
    topic = []
else:
    topic = u['answers'].get(event_id, {}).get(str(topic_id), [])
        </code></pre>
    </div>

    <div class="slide">
        <h4>We use object model methods</h4>
        <pre><code class="python">
topic = UserEvent.get_topic_answers(user_id, event_id, topic_id)
        </code></pre>
    </div>

    <div class="slide">
        <h4>The code then become much more readable</h4>
        <pre><code class="python">
def matches(self, user_id, event_id, topic_id):
    """ Return a list of users whose answer is similar. """
    topic = UserEvent.get_topic_answers(user_id, event_id, topic_id)

    if topic is None:
        return None

    return UserEvent.matches(user_id, event_id, topic_id)
    </div>

</section>

<section class="slide" id="testing">
    <h2>Lettuce</h2>
    <p>Is lettuce a vegetable or a testing platform?!</p>
    <pre><code>Sample code?</code></pre>
</section>

<section class="slide" id="worker">
    <h2>Worker Process</h1>
    <p>MongoDB as a low-latency queue.</p>
</section>

<section class="slide" id="facebook">
    <h2>Facebook Integration</h2>
    <p>Take advantage of an existing account, friends, and sharing. Great for the product, no fun for developers.</p>
    <pre><code>
This is what some complicated Facebook code looks like.
    </code></pre>
</section>

<section class="slide" id="facebook-api">
    <h2>Facebook API Issues</h2>
    <p>Only the most critical ones...</p>
    <ul>
        <li class="slide" id="facebook-api-downtime">
            <h3>Downtime</h3>
        </li>
        <li class="slide" id="facebook-api-speed">
            <h3>Speed (Latency in every request)</h3>
        </li>
        <li class="slide" id="facebook-api-changes">
            <h3>Sudden Changes</h3>
        </li>
        <li class="slide" id="facebook-api-docs">
            <h3>Documentation - Comparable to Early-Stage FOSS</h3>
        </li>
    </ul>
</section>

<section class="slide" id="api-improvements">
    <h2>How Your Public API Can Be Better</h2>
    <p>K.I.S.S.</p>
    <ul>
        <li class="slide" id="hierarchy">
            <h3>Namespaces are one honking great idea -- let's do more of those!</h3>
            <p>Seriously, hierarchical organization is easy to understand and use.</p>
        </li>
        <li class="slide" id="document-calls">
            <h3>Document every API call</h3>
            <p>Explain what it does and any nuances.</p>
        </li>
        <li class="slide" id="document-variables">
            <h3>Document every variable</h3>
            <p>Type, possible options (and what each option means), and if its required.</p>
        </li>
    </ul>
</section>

<section class="slide" id="steps">
    <h2>Mapping Game Logic to Objects</h2>
    <p>Multiplayer social games are step and role based.</p>
    <h2>System tasks and timers</h2>
    <p>Certain tasks have time limits or system requirements</p>
    <pre><code>Sample gamesteps code</code></pre>
</section>

<section class="slide" id="mongo">
    <h2>The State of Mongo</h2>
    <p>Mongo is schema-less and non-relational. It's really cool!</p>
    <h2>The State of Mongo in Python</h2>
    <p>Mongo in Python is sorta limited. So we rolled our own.</p>
    <h2>ORM, ODM, etc.</h2>
    <p>More stuff about working with Python and our choice of MongoEngine.</p>
</section>

<section class="slide" id="migrations">
    <h2>Schema-Less Migrations</h2>
    <p>Data formats change, our "schema" changes, etc.</p>
    <h2>Auto-Migrations</h2>
    <p>Auto-migrate on deploy, how we do it, the benefits, the problems, etc.</p>
</section>

<section class="slide" id="fin">
    <h1>Questions? Comments?</h1>
</section>

<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<p class="deck-status">
    <span class="deck-status-current"></span>
    /
    <span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
    <label for="goto-slide">Go to slide:</label>
    <input type="number" name="slidenum" id="goto-slide">
    <input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>


  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="jquery-1.6.4.min.js"><\/script>')</script>

<!-- Deck Core and extensions -->
<script src="core/deck.core.js"></script>
<script src="extensions/menu/deck.menu.js"></script>
<script src="extensions/goto/deck.goto.js"></script>
<script src="extensions/status/deck.status.js"></script>
<script src="extensions/navigation/deck.navigation.js"></script>
<script src="extensions/hash/deck.hash.js"></script>

<!-- Specific to this page -->
<script src="introduction.js"></script>
<script src="highlight/highlight.pack.js"></script>
<script>
    hljs.tabReplace = '    ';
    hljs.initHighlightingOnLoad();
</script>

</body>
</html>
